# 日本語文書
# 定義名見直し方針（一次案）

## 前提条件
- 本リポジトリ外部から publish されるトピック（例：`sig_recog`、`manual_start`）の名称は変更対象外とする。
- `ObstacleAvoidanceHint` の左右オフセット（旧 `left_is_open` / `right_is_open`、現 `left_offset_m` / `right_offset_m`）は、左右のクリアランス値ではなく回避オフセット量を表すことを明示する。

## メッセージ／サービス
| 対象 | 対応結果 | 反映内容 | 備考 |
| ---- | -------- | -------- | ---- |
| `route_msgs/msg/ObstacleAvoidanceHint` | **名称維持** | フィールドを `front_clearance_m` / `left_offset_m` / `right_offset_m` へ改名し、実際の意味を明示。 | 既存ロジックは新名称へ追随済み。 |
| `route_msgs/msg/FollowerState` | **完了** | 追従インデックス/ラベルを `active_waypoint_*` へ統合し、距離・ヒント項目を `*_m` 付き名称へ整理。 | `next_waypoint_label` を廃止し、UI も更新。 |
| `route_msgs/msg/Route` | **完了** | `start_waypoint_label` へ改名し、Core⇔ROS 変換で開始インデックスと整合を取るよう調整。 | 旧 `start_label` 参照もフォールバックとして残す。 |
| `route_msgs/msg/RouteState` | **完了** | `status` を `uint8` 列挙に変更し、`RouteState.STATUS_*` 定数を定義。Node 側で文字列→列挙の変換を実装。 | 未知値は `STATUS_UNKNOWN` に丸める。 |
| `route_msgs/srv/ReportStuck` | **完了** | 応答フィールドを `decision_code` へ改名し、`DECISION_*` 定数を追加。呼び出し側の判定・ログも更新。 | 既定列挙: none/replan/skip/failed。 |

### `ObstacleAvoidanceHint` 名称検討の結論
- 距離情報と回避オフセットの双方を扱う現状でも「回避のためのヒント」を与える目的が明確であり、メッセージ名の変更によるメリットは限定的と判断した。
- `ObstacleInfo` のような一般名詞は用途が広すぎ、既存ノードの役割を曖昧にする懸念があるため採用しない。
- フィールド改名で誤解要因を除去したため、メッセージ名は現状維持とする。

## トピック
| 対象 | 変更方針 | 理由 | 備考 |
| ---- | -------- | ---- | ---- |
| `route_follower` → `sig_recog` | **変更しない** | 外部ノードが publish しておりリポジトリ内で制御できないため。 | リネーム時は外部チームとの合意が必要。 |
| `route_follower` → `manual_start` など外部 publish トピック | **変更しない** | 同上。 | - |
| `obstacle_monitor` → `sensor_viewer` | `obstacle_monitor/viewer` や `scan_debug_image` など内容が分かる名称に改名を検討 | 具体的な可視化内容を表現し、購読者が用途を理解しやすくする。 | 可視化サブスクライバとの整合を確認する。 |

## パラメータ
| 対象 | 対応結果 | 反映内容 | 備考 |
| ---- | -------- | -------- | ---- |
| `route_manager` | **完了** | `offset_step_max_m` へ改名し、Node/Core/params を統一。 | 既定値は従来通り 1.0。 |
| `obstacle_monitor` | **完了** | `front_cone_half_deg` / `avoid_offset_min_m` へ改名し、YAML 既定値をコードと揃えて 0.75[m] に修正。 | パラメータ説明・ログも更新済み。 |
| `robot_navigator` | **完了** | 距離切替パラメータを `obstacle_distance_mode` へ改名し、ドキュメントも更新。 | `scan` / `hint` の列挙選択を保持。 |
| `robot_simulator` | **現状維持** | `rotation_speed_degps` を継続使用し、追加改名は不要と判断。 | 変更なし。 |

## 文字列長の整理観点
- 上表の通り、長文化していた候補はできる限り 3〜4 語程度でまとめ、単位接尾辞（`_m`, `_deg` 等）を残して意味を伝える。
- 既存名称が十分に短く用途が伝わるもの（例：`rotation_speed_degps`）については、無理な短縮よりも現状維持を優先する。

## 今後の進め方
1. 上記候補について関係者合意を得る。
2. 合意済みの項目を対象にメッセージ・サービス定義、ノード実装、パラメータファイルを順次更新する。
3. 変更に伴うドキュメント（設計書・README 等）を更新し、命名変更の背景を記録する。
