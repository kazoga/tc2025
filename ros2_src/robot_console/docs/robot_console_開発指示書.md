# Codex 指示プロンプト：robot_console パッケージ新規作成

## 🎯 タスク概要

新しいROS2パッケージ **`robot_console`** を作成してください。  
このノードは、ロボットシステム全体の **モニタリング・統合管理・GUI操作** を担う統合ノードです。  
開発にあたっては、既に用意されている `AGENTS.md` の規約とワークフローに従って進めてください。

---

## 🧱 開発目的

- GUIから、既存のROS2ノード群（例：`route_manager`, `route_follower`, `obstacle_monitor`, `robot_navigator` など）を **起動・停止・再起動** できるようにする。  
- 各ノードの発行するトピック（例：状態・ログ・画像など）を購読し、**一元的に可視化**する。  
- GUI操作によって、**フラグや制御指令トピックを送信**できる。  

このノードは、つくばチャレンジ2025におけるロボット統合オペレーションツールの役割を持ちます。

---

## 🪜 開発進行ルール（`AGENTS.md`に準拠）

次のフェーズ順で、ユーザーと**対話しながら進めてください**。  
承認が得られるまで、次フェーズには進んではなりません。

### フェーズ0：初期セットアップ（必須）

- まず最初に、以下のディレクトリ構成を**作成・提示**してください。  
- 実際の実装にはまだ入らず、構成のレビューを経てから着手に進んでください。

```
ros2_src/robot_console/
├── robot_console/
│   ├── __init__.py
│   ├── robot_console_node.py     # ROS2ノード（rclpy）
│   ├── gui_core.py               # 非ROS依存ロジック
│   ├── ui_main.py                # tkinterメインウィンドウ
│   ├── ui_components/            # GUI部品（ボタン／パネル等）
│   └── utils/                    # 汎用関数・データ整形など
├── launch/
│   └── robot_console.launch.py
├── docs/
│   └── robot_console_詳細設計書.md      # 設計書はこの中に作成
├── tools/
│   ├── mock_ui.py                 # GUIモック表示スクリプト（実行可能）
│   └── test_data/                 # GUIモック用のダミーデータ等
├── README.md
├── setup.py
├── setup.cfg
└── package.xml
```

> 🔸 まずこの構成を生成・提示し、ユーザーの承認を得てから  
> 「フェーズ1：情報分析」に進むこと。

---

### フェーズ1：情報分析

- リポジトリ全体を解析し、各ROS2パッケージが発行・購読するトピック／サービスを一覧化。  
- GUIが購読すべき情報、送信すべきトピックを**提案前に質問**して、ユーザーと対話的に確定。  
- 表形式で提案結果を出力（項目名・データ型・更新頻度・操作可否）。

### フェーズ2：GUIモック作成

- tkinterを用いた**実行可能モックスクリプト（`tools/mock_ui.py`）**を生成。  
- ROS通信はダミーデータで代替し、見た目と操作感を確認できる構成にする。  
- ユーザーが実行してフィードバックを返すまで、次フェーズに進まない。

### フェーズ3：詳細設計書作成

- GUI構成・操作対象・更新周期・非同期処理設計をMarkdownドキュメントとして  
  `docs/robot_console_詳細設計書.md` にまとめて提示する。  
- ユーザーのレビュー・修正指摘を反映し、承認後にフェーズ4へ。

### フェーズ4：実装

- 設計書に基づき、`robot_console` パッケージを完全実装。  
- ROS層とUI層を分離し、pytestで検証可能な構成とする。  
- GUIのイベントループとROSノードループが安全に共存できる設計を採用。  

---

## 🧠 技術要件

| 項目 | 指定内容 |
|------|-----------|
| GUIライブラリ | `tkinter` |
| ROSバージョン | ROS2 Foxy 以降 |
| 使用言語 | Python3 |
| ノード名 | `robot_console`（パッケージと同名） |
| 実装方針 | ROS依存部とUI部を明確に分離（`gui_core.py` ⇔ `robot_console_node.py`） |
| ドキュメント格納 | `/docs` 以下 |
| モック・テスト格納 | `/tools` 以下 |
| テスト方式 | Python単体で実行可能なmockテスト（ROS環境不要） |

---

## 💬 Codexへの追加要請

- 各フェーズで提案前に、**確認質問をユーザーに行うこと。**  
  （例：「どのノードを監視対象に含めますか？」、「画像表示を含めますか？」など）  
- 質問・提案・承認の対話を繰り返しながら、段階的に仕様を確定すること。  
- GUIモックは、単なる図ではなく**Pythonスクリプトとして実際に実行可能**な形で生成すること。  
- 実装フェーズは、**詳細設計書のユーザー承認後**にのみ着手すること。  

---

## ✅ 最初に実施すべきこと（Codex初回タスク）

1. 上記ディレクトリ構成を提示し、`robot_console` パッケージの初期スケルトンを生成する。  
2. その後、ユーザーに対して次の質問を行い、情報分析フェーズを開始する準備をする：  
   - 「監視対象ノードはどれですか？」  
   - 「どのトピック／サービスをGUIで可視化したいですか？」  
   - 「GUI上で操作したい（送信したい）トピックはありますか？」  
   - 「画像や地図などの可視化を含めますか？」  

---

## 🧩 出力フォーマット指定

Codexは各フェーズで以下を出力する：

| フェーズ | 出力内容 |
|----------|-----------|
| 0 | ディレクトリ構成＋ファイル概要説明 |
| 1 | トピック・サービス分析結果とGUI表示項目提案 |
| 2 | `tools/mock_ui.py` の完全スクリプト |
| 3 | `docs/robot_console_詳細設計書.md`（Markdown形式） |
| 4 | パッケージ全ファイルの完全実装（省略なし） |

---

### 🚀 Codexへの最初の指示

> 「上記方針に従って、`robot_console` パッケージの初期ディレクトリ構成を作成し、  
>  その構成案を提示してください。  
>  まだ実装には進まず、構成案レビューを行います。」

---
